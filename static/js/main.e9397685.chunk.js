(this["webpackJsonpdevs-webviewer"]=this["webpackJsonpdevs-webviewer"]||[]).push([[0],{106:function(e,t,n){"use strict";(function(e){var a=n(77),r=(n(107),n(34)),c=n(64),o=Object(r.a)({reducer:c.b,middleware:(e&&Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}),Object(a.a)(Object(r.d)()))});t.a=o}).call(this,n(85))},142:function(e,t,n){e.exports=n(378)},378:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(11),o=n.n(c),i=n(40),s=n(17),l=n(412),u=n(422),d=n(423),f=n(417),m=n(424),p=n(90),v=n.n(p),g=n(91),y=n.n(g),h=n(92),b=n.n(h),E=n(2),C=n(19),k=n(75),w=n(23),j=n.n(w),O=n(65),S=n(414),x=n(415),N=n(416),A=n(418),D=n(419),F=n(420),R=n(382),J=n(421),T=n(6),V=n.n(T),W=n(109),P=n(25);function B(e,t){return Object(i.c)(V.a.isFunction(e)?e:function(t){return V.a.isArray(e)?V.a.pick(t,e):t[e]},t)||{}}var I=n(64);var L=Object(l.a)((function(e){return{root:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",padding:10},jsonViewer:{position:"relative",border:"1px solid black",height:"100%",width:"100%",margin:10,minWidth:450},svgViewer:{position:"relative",border:"1px solid black",height:"100%",width:"100%",margin:10,minWidth:450},svgButtonTopButtonContainer:{display:"flex",justifyContent:"space-between",position:"absolute",top:0,right:0},picklist:{margin:10,minWidth:150},assignButton:{margin:10},cards:{display:"flex",flexWrap:"wrap",justifyContent:"center",alignContent:"flex-start",height:"90%",overflow:"auto"},card:{minWidth:180,display:"flex",flexDirection:"column",margin:10,position:"relative",cursor:"pointer",border:"1px solid white"},previewCard:{minWidth:180,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",margin:10,border:"1px solid white"},selectedCard:{border:"1px solid tomato"},svgContainer:{background:"#ffffff",marginTop:e.spacing(8),marginLeft:e.spacing(1),marginRight:e.spacing(1),padding:e.spacing(2)},cardWarning:{position:"absolute",bottom:0,right:0},svg:{width:"100%",height:"100%",objectFit:"cover",overflow:"hidden"},jsonView:{padding:10},cardContainer:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},button:{textTransform:"none",margin:5}}}));function _(e){var t=e.content,n=e.onConfirm,a=e.onClose,c=e.open,o=e.showCancel;return r.a.createElement(m.a,{onClose:a,open:c},r.a.createElement(S.a,null,r.a.createElement(x.a,null,t)),r.a.createElement(N.a,null,r.a.createElement(f.a,{color:"primary",onClick:n},"Ok"),o&&r.a.createElement(f.a,{autoFocus:!0,color:"primary",onClick:a},"Cancel")))}var M=function(e){var t=e.svgFile,n=e.jsonFile,a=L(),c=B("tool"),o=c.jsonContent,l=c.originalJsonContent,u=c.svgContent,m=c.picklistValue,p=c.picklistOptions,v=c.selectedCard,g=c.selectedSvgElements,y=c.strokeMap,h=c.associatedCards,b=c.allSelected,w=function(e){var t=I.a[e],n=Object(i.b)();return(t=V.a.reduce(t,(function(e,t,a){return e[a]=function(){return n(t.apply(void 0,arguments))},e}),{}))||{}}("tool"),S=w.setJsonContent,x=w.setSvgContent,N=w.setPicklistValue,T=w.setPicklistOptions,M=w.setSelectedCard,H=w.setSelectedSvgElements,K=w.setStrokeMap,U=w.setAssociatedCards,z=w.setAllSelected,G=w.setOriginalJsonContent,q=r.a.useState(""),Q=Object(s.a)(q,2),X=Q[0],Y=Q[1],Z=r.a.useState(!1),$=Object(s.a)(Z,2),ee=$[0],te=$[1],ne=r.a.useState(!1),ae=Object(s.a)(ne,2),re=ae[0],ce=ae[1],oe=r.a.useState(!1),ie=Object(s.a)(oe,2),se=ie[0],le=ie[1],ue=r.a.useState({}),de=Object(s.a)(ue,2),fe=de[0],me=de[1],pe=r.a.useRef(null);pe.current=v;var ve=r.a.useRef(null);ve.current=g;var ge=r.a.useRef(null);ge.current=y;var ye=r.a.useRef(null);ye.current=h;var he=r.a.useRef(null);he.current=o;var be=r.a.useRef(null);be.current=u;var Ee=r.a.useRef(null);Ee.current=fe;var Ce=function(){var e=Object(O.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return n=e.sent,e.abrupt("return",JSON.parse(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ke=function(e){return new Promise((function(t){var n=new FileReader;n.onload=function(){return t(n.result)},n.readAsDataURL(e)}))},we=function(){var e=Object(O.a)(j.a.mark((function e(t){var n,a,r,c,o,i,s,l,u,d;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=be.current,e.next=3,Ce(t);case 3:for(a=e.sent,r=Object.keys(a),c=[],o=0;o<r.length;++o)i=r[o],s=a[i],Array.isArray(s)&&c.push(i);T(c),G(V.a.cloneDeep(a)),N(c[0]),l={},u=!1,n&&(d=Ee.current,V.a.each(a,(function(e,t){V.a.each(e,(function(e,n){var a=e.svg;if(Array.isArray(a)){var r=a.filter((function(e){return e in d||(u=!0,!1)}));r.length>0&&(l["".concat(t,"-").concat(n)]=!0),e.svg=r}}))}))),U(l),u&&ce(!0),S(a);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(){var e=Object(O.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke(t);case 2:n=e.sent,x(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();r.a.useEffect((function(){n&&we(n)}),[n]),r.a.useEffect((function(){t&&je(t)}),[t]),r.a.useEffect((function(){setTimeout((function(){var e={},t=!1,n={};P.a("#workspace-svg").select("g").selectAll("*").each((function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];var c=a[1],o=P.a(this),i=o.attr("id");V.a.isNil(i)&&(i="e-".concat(c),o.attr("id",i)),i="#".concat(i),e[i]={id:i,stroke:o.attr("stroke")},n[i]=!0})).on("click",(function(){t=!0;var e=this.id;e="#".concat(e);var n=Object(k.a)({},ve.current),a=ge.current,r=P.a(this);e in n?(r.attr("stroke",a[e].stroke),function(e,t){if(!V.a.isNil(pe.current)&&!V.a.isEmpty(e)){var n=he.current,a=V.a.cloneDeep(n),r=pe.current,c=r.key,o=r.index,i=a[c][o].svg;a[c][o].svg=V.a.filter(i,(function(e){return e!==t})),S(a),delete e[t],H(e);var s=V.a.cloneDeep(ye.current);V.a.isEmpty(a[c][o].svg)&&delete s["".concat(c,"-").concat(o)],U(s)}}(n,e)):(n[e]=!0,r.attr("stroke","tomato"),function(e){if(!V.a.isNil(pe.current)&&!V.a.isEmpty(e)){var t=he.current,n=V.a.cloneDeep(t),a=pe.current,r=a.key,c=a.index;n[r][c].svg=V.a.map(e,(function(e,t){return t})),S(n),H(e);var o=V.a.cloneDeep(ye.current);o["".concat(r,"-").concat(c)]=!0,U(o)}}(n))})).attr("pointer-events","fill").style("cursor","pointer"),t&&!se&&le(!0),K(e);var a=V.a.cloneDeep(he.current);if(a){var r={},c=!1;V.a.each(a,(function(e,t){V.a.each(e,(function(e,a){var o=e.svg;if(Array.isArray(o)){var i=o.filter((function(e){return e in n||(c=!0,!1)}));i.length>0&&(r["".concat(t,"-").concat(a)]=!0),e.svg=i}}))})),U(r),c&&ce(!0),S(a)}me(n)}),0)}),[u]),r.a.useEffect((function(){se&&P.a("#workspace-svg").select("g").selectAll("*").each((function(){var e=this.id;e="#".concat(e);var t=P.a(this);e in ve.current&&t.attr("stroke","tomato")}))}),[u,o]),r.a.useEffect((function(){var e=pe.current,t={};if(V.a.isNil(e))P.a("#workspace-svg").select("g").selectAll("*").each((function(){var e=this.id;e="#".concat(e);var t=P.a(this),n=ge.current[e];t.attr("stroke",n.stroke)}));else{var n=e.key,a=e.index,r=he.current,c=r[n][a];if(!V.a.isNil(c)){var o=!0,i=c.svg;if(Array.isArray(i)||(i=[],o=!1),Array.isArray(i)){var s=i.reduce((function(e,t){return e.add(t),e}),new Set);P.a("#workspace-svg").select("g").selectAll("*").each((function(){var e=this.id;e="#".concat(e);var n=P.a(this);if(s.has(e))t[e]=!0,n.attr("stroke","tomato");else{e in t&&delete t[e];var a=ge.current[e];n.attr("stroke",a.stroke)}}))}if(!o){var l=V.a.cloneDeep(r);l[n][a].svg=i,S(l)}}}H(t)}),[v]);var Oe=function(e,t){Object(k.a)({},pe.current).index===e?M(null):M({key:t,index:e})},Se=function(e,t){return V.a.reduce(t,(function(t,n,a){return Array.isArray(n)||"ports"===e&&"type"===a||t.push(r.a.createElement(d.a,{key:a,p:.5},r.a.createElement("b",null,a),": ".concat(n))),t}),[])};return r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{className:a.root},r.a.createElement(d.a,{className:a.jsonViewer},o&&r.a.createElement(d.a,null,r.a.createElement(d.a,{p:1},r.a.createElement(f.a,{className:a.button,color:b?"primary":void 0,onClick:function(){z(!0),M(null)},variant:"contained"},"All"),p.map((function(e,t){return r.a.createElement(f.a,{key:t,className:a.button,color:e!==m||b?void 0:"primary",onClick:function(){N(e),M(null),z(!1)},variant:"contained"},"ports"===e?"output ports":e)})))),m&&r.a.createElement(d.a,{className:a.cards},function(){var e=he.current;if(b)return V.a.reduce(e,(function(e,t,n){return Array.isArray(t)&&t.forEach((function(t,c){if("ports"===n&&"output"!==t.type)return e;e.push(r.a.createElement(d.a,{key:"".concat(n,"-").concat(c),className:a.cardContainer},r.a.createElement(A.a,{className:Object(E.a)(a.card,Object(C.a)({},a.selectedCard,v&&v.index===c&&v.key===n)),onClick:function(){return Oe(c,n)}},r.a.createElement(D.a,null,Se(n,t)),!("".concat(n,"-").concat(c)in h)&&r.a.createElement(F.a,{className:a.cardWarning},r.a.createElement(J.a,null)))))})),e}),[]);var t=e[m];if(Array.isArray(t)){var n=t.filter((function(e){return"ports"!==m||"input"!==e.type}));return V.a.isEmpty(n)?r.a.createElement(d.a,{p:4},r.a.createElement(R.a,null,"There are no ports for this model.")):n.reduce((function(e,t,n){return e.push(r.a.createElement(d.a,{key:n,className:a.cardContainer},r.a.createElement(A.a,{className:Object(E.a)(a.card,Object(C.a)({},a.selectedCard,v&&v.index===n)),onClick:function(){return Oe(n,m)}},r.a.createElement(D.a,null,Se(m,t)),!("".concat(m,"-").concat(n)in h)&&r.a.createElement(F.a,{className:a.cardWarning},r.a.createElement(J.a,null))))),e}),[])}return null}()),o&&r.a.createElement(d.a,{pl:2,pt:1},r.a.createElement(R.a,null,"Note: Input ports will be automatically associated."))),r.a.createElement(d.a,{className:a.svgViewer},r.a.createElement(d.a,{className:a.svgButtonTopButtonContainer},r.a.createElement(d.a,{p:1},r.a.createElement(f.a,{className:a.button,color:"primary",disabled:!o&&!u,onClick:function(){te(!0),Y("reset")},variant:"contained"},"Reset"),r.a.createElement(f.a,{className:a.button,color:"primary",disabled:!o&&!u,onClick:function(){te(!0),Y("clearAll")},variant:"contained"},"Clear All"))),u&&r.a.createElement(d.a,{className:a.svgContainer,id:"workspace-svg-container"},r.a.createElement(W.a,{className:a.svg,id:"workspace-svg",src:u})))),r.a.createElement(_,{content:"reset"===X?"All the modifications will be lost. Do you want to continue?":"All associations between the model structure elements and the diagram will be removed. Do you want to continue?",onClose:function(){return te(!1)},onConfirm:"reset"===X?function(){te(!1),M(null);var e={},t=!1,n=V.a.cloneDeep(l);if(u){var a=Ee.current;V.a.each(n,(function(n,r){V.a.each(n,(function(n,c){var o=n.svg;if(Array.isArray(o)){var i=o.filter((function(e){return e in a||(t=!0,!1)}));i.length>0&&(e["".concat(r,"-").concat(c)]=!0),n.svg=i}}))}))}U(e),t&&ce(!0),S(n)}:function(){te(!1);var e=he.current,t=V.a.cloneDeep(e);V.a.each(t,(function(e){Array.isArray(e)&&V.a.each(e,(function(e){e.svg=[]}))})),S(t),M(null),U({})},open:ee,showCancel:!0}),r.a.createElement(_,{content:"Errors were detected in associations between model structure elements and the diagram provided. They will be ignored.",onClose:function(){return ce(!1)},onConfirm:function(){return ce(!1)},open:re,showCancel:!1}))},H=n(108),K=Object(l.a)((function(e){return{error:{color:e.palette.error.main}}})),U=function(e){var t=e.className,n=e.style,a=e.onSave,c=e.error,o=e.acceptedFiles,i=e.title,l=K(),u=r.a.useState(!1),m=Object(s.a)(u,2),p=m[0],v=m[1];return r.a.createElement(d.a,{alignItems:"center",className:t,display:"flex",flexDirection:"row",style:n},r.a.createElement(f.a,{color:"primary",onClick:function(){v(!0)},variant:"contained"},i),r.a.createElement(H.a,{acceptedFiles:o,filesLimit:1,maxFileSize:1/0,onClose:function(){v(!1)},onSave:function(e){v(!1),a(e)},open:p,showPreviews:!0}),c&&r.a.createElement(R.a,{className:l.error},c.message))};U.defaultProps={className:"",style:{},error:void 0,acceptedFiles:[],title:void 0};var z=U,G=Object(l.a)((function(e){return{content:{height:"100vh",transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},buttonContainer:{display:"flex",flexDirection:"row",justifyContent:"center",position:"absolute",bottom:0,right:0,margin:30},button:{marginRight:5}}}));var q=function(){var e=G(),t=r.a.useState(null),n=Object(s.a)(t,2),a=n[0],c=n[1],o=r.a.useState(!1),i=Object(s.a)(o,2),l=i[0],p=i[1],g=r.a.useState(null),h=Object(s.a)(g,2),C=h[0],k=h[1],w=B("tool"),j=w.svgContent,O=w.jsonContent;return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,null),r.a.createElement("title",null,"DEVS Webviewer Linker"),r.a.createElement("main",{className:e.content},(a||C)&&r.a.createElement(M,{jsonFile:a,svgFile:C}),r.a.createElement(d.a,{className:e.buttonContainer},!O&&r.a.createElement(z,{acceptedFiles:["application/json"],className:e.button,onSave:function(e){c(e[0])},title:"Load JSON"}),!j&&r.a.createElement(z,{acceptedFiles:["image/svg+xml"],className:e.button,onSave:function(e){k(e[0])},title:"Load SVG"}),O&&r.a.createElement(f.a,{className:e.button,color:"primary",onClick:function(){return p(!0)},variant:"contained"},"Show JSON"),O&&j&&r.a.createElement(f.a,{className:e.button,color:"primary",onClick:function(){var e=document.getElementById("workspace-svg-container").children[0];e.setAttribute("xmlns","http://www.w3.org/2000/svg");var t=e.outerHTML,n=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',t],{type:"image/svg+xml;charset=utf-8"}),a=v()();a.file("result.svg",n),a.file("result.json",JSON.stringify(O,null,2)),a.generateAsync({type:"blob"}).then((function(e){y.a.saveAs(e,"result.zip")}))},variant:"contained"},"Download")),r.a.createElement(m.a,{fullScreen:!0,onClose:function(){return p(!1)},open:l},r.a.createElement(d.a,{pl:1,pr:1},r.a.createElement(b.a,{className:Object(E.a)("json",e.jsonView)},JSON.stringify(O,null,2))))))},Q=n(106).a;function X(){return r.a.createElement(i.a,{store:Q},r.a.createElement(q,null))}o.a.render(r.a.createElement(X,null),document.getElementById("root"))},64:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var a=n(6),r=n.n(a),c=n(19),o=n(34),i=Object(o.b)("reset"),s={jsonFile:null,svgFile:null,jsonContent:"",originalJsonContent:"",svgContent:"",picklistValue:"",picklistOptions:[],selectedCard:null,selectedSvgElements:{},strokeMap:{},associatedCards:{},allSelected:!0,isReseted:!0},l=Object(o.c)({name:"tool",initialState:s,reducers:{setJsonContent:function(e,t){e.jsonContent=t.payload},setOriginalJsonContent:function(e,t){e.originalJsonContent=t.payload},setSvgContent:function(e,t){e.svgContent=t.payload},setPicklistValue:function(e,t){e.picklistValue=t.payload},setPicklistOptions:function(e,t){e.picklistOptions=t.payload},setSelectedCard:function(e,t){e.selectedCard=t.payload},setSelectedSvgElements:function(e,t){e.selectedSvgElements=t.payload},setStrokeMap:function(e,t){e.strokeMap=t.payload},setAssociatedCards:function(e,t){e.associatedCards=t.payload},setIsReseted:function(e,t){e.isReseted=t.payload},setAllSelected:function(e,t){e.allSelected=t.payload}},extraReducers:Object(c.a)({},i,(function(e){Object.assign(e,s)}))}),u={tool:r.a.assign(l.actions,{reset:i})},d={tool:l.reducer}}},[[142,1,2]]]);
//# sourceMappingURL=main.e9397685.chunk.js.map